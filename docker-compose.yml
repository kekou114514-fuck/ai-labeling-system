version: '3.8'

services:
  # === 1. Label Studio æœåŠ¡ ===
  label-studio:
    image: heartexlabs/label-studio:latest
    container_name: label_studio_server
    restart: unless-stopped
    ports:
      - "8080:8080"
    environment:
      - LABEL_STUDIO_LOCAL_FILES_SERVING_ENABLED=true
      - LABEL_STUDIO_LOCAL_FILES_DOCUMENT_ROOT=/data
      - LABEL_STUDIO_DISABLE_SIGNUP_WITHOUT_LINK=false
      - LABEL_STUDIO_USERNAME=admin@example.com
      - LABEL_STUDIO_PASSWORD=password123
    volumes:
      # æ˜ å°„æ•°æ®ï¼šå®¿ä¸»æœº project_data -> å®¹å™¨ /data
      - ./project_data:/data
      # æŒä¹…åŒ– LS çš„é…ç½®å’Œæ•°æ®åº“
      - ./ls_data:/label-studio/data

  # === 2. AI å·¥å…·ç®± (è¿è¡Œæ‚¨çš„è„šæœ¬) ===
  ai_toolbox:
    build: .
    container_name: ai_toolbox_worker
    restart: "no"
    environment:
      # å‘Šè¯‰è„šæœ¬ LS åœ¨å“ªé‡Œ
      - LS_URL=http://label-studio:8080
      # ğŸ‘‡ æ³¨æ„ï¼šè¿™é‡Œä¸å†å†™ LS_API_KEY=${...}ï¼Œè€Œæ˜¯é€šè¿‡ä¸‹é¢çš„ env_file åŠ è½½
      - DATA_ROOT=/data
      - HF_ENDPOINT=https://hf-mirror.com
    # ğŸ‘‡ æ–°å¢ï¼šæ˜¾å¼åŠ è½½åä¸º "env" çš„æ–‡ä»¶
    env_file:
      - env
    volumes:
      - ./project_data:/data
      - ./scripts:/app/scripts
      - ./models:/app/models
    command: tail -f /dev/null
